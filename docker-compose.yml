version: "2"
services:
    ytdl_material:
        environment:
            ytdl_mongodb_connection_string: 'mongodb://ytdl-mongo-db:27017'
            ytdl_use_local_db: 'false'
            write_ytdl_config: 'true'
            # Option 1: Let container start as root and drop privileges (default behavior)
            # Uncomment these lines to set custom UID/GID:
            # UID: 1000
            # GID: 1000

            # SSL/HTTPS Configuration (optional)
            # Uncomment and set paths to enable HTTPS:
            # ytdl_ssl_cert_path: /mnt/keys/bindable-internal/lurker/fullchain-or-ca.pem
            # ytdl_ssl_key_path: /mnt/keys/bindable-internal/lurker/privkey.pem

            # Reverse Proxy Whitelist (optional)
            # Whitelists the reverse proxy's IP (the direct connecting IP, not end clients)
            # This checks which reverse proxy is allowed to connect, not client IPs
            # Leave commented for no IP filtering
            # Example single IP: 172.28.0.100/32
            # Example subnet: 172.28.0.0/24
            # Example multiple ranges: 172.28.0.100/32,10.0.0.0/8
            # ytdl_reverse_proxy_whitelist: 172.28.0.100/32
        # Option 2: Start container directly as non-root user (more secure, faster)
        # Uncomment this line to run as a specific user (requires proper volume permissions):
        # user: "1000:1000"
        restart: always
        depends_on:
            - ytdl-mongo-db
        volumes:
            - ./appdata:/app/appdata
            - ./audio:/app/audio
            - ./video:/app/video
            - ./subscriptions:/app/subscriptions
            - ./users:/app/users
        ports:
            - "8998:17442"
        image: tzahi12345/youtubedl-material:latest
    ytdl-mongo-db:
        # If you are using a Raspberry Pi, use mongo:4.4.18
        image: mongo:4
        logging:
            driver: "none"          
        container_name: mongo-db
        restart: always
        volumes:
            - ./db/:/data/db
